---
sidebarTitle: Local Development
title: Setting Up Your Dev Environment
description: Complete guide to set up your Karrio development environment
---

# Local Development

Welcome to the Karrio development guide! This resource covers the classic localhost workflow and the optional HTTPS proxy powered by Caddy. Whether you're adding a new carrier integration, enhancing the API, or improving the dashboard, this guide walks you through the tooling that keeps local feedback fast.

> [!TIP]
>
> Prefer containers? Jump to [Docker-based development](#docker-based-development-alternative) for the compose workflow.

## Architecture Overview

Karrio is built with a flexible architecture consisting of several components:

- **API Server**: Django REST Framework application that provides the core API
- **Dashboard**: Next.js application for the user interface
- **Docs**: Next.js site for documentation and marketing pages
- **Worker**: Huey workers for background tasks
- **Database**: PostgreSQL for data storage (SQLite supported for development)
- **Cache**: Redis for caching and as a message broker
- **Maildev**: Local SMTP sink used during development
- **Caddy (optional)**: HTTPS proxy for `api.karrio.local`, `app.karrio.local`, `karrio.local`

## Prerequisites

Before you begin, make sure you have the following installed:

- [Git](https://git-scm.com/downloads)
- [Node.js v18+ and npm v10+](https://nodejs.org/en/download/)
- [Python 3.12+](https://www.python.org/downloads/)
- [Docker](https://www.docker.com/products/docker-desktop) & [Docker Compose](https://docs.docker.com/compose/install/) (optional, for Docker-based setup)

> [!WARNING]
>
> Windows developers should use [Windows Subsystem for Linux (WSL)](https://learn.microsoft.com/windows/wsl/) for the best experience. Native Windows shells are not supported.

> [!NOTE]
>
> `./bin/install-dev` is **idempotent**. If `pyenv`, `nvm`, Python, or Node.js are already installed and meet the supported versions, the script reuses them instead of overwriting.

## Quick Start (Dockerless)

```bash filename="Terminal"
git clone https://github.com/[YOUR_USERNAME]/karrio.git
cd karrio

# Optional: install native dependencies (mkcert, caddy, libffi, zint, …)
./bin/install-binaries

# Provision Python, Node, certificates, env files (safe to rerun)
./bin/install-dev

# Launch API + Dashboard + Docs + Maildev (localhost by default)
./bin/dev up
```

`./bin/install-dev` ensures that pyenv/nvm are present, installs the supported Python and Node.js versions, installs repo dependencies, generates mkcert certificates under `.karrio/certs`, copies default `.env` files, and prints a summary with the relevant URLs. The env files keep `http://localhost:*` defaults; HTTPS is opt-in via the `--with-https` flag on `./bin/dev up`.

Add these entries to `/etc/hosts` so browsers resolve the local HTTPS domains:

```
127.0.0.1 api.karrio.local app.karrio.local karrio.local
```

If Caddy cannot bind to ports 80/443 on Linux, grant the binary privileged-port access once:

```bash filename="Terminal"
sudo setcap "cap_net_bind_service=+ep" $(command -v caddy)
```

Advanced: run the proxy manually (normally `./bin/dev up --with-https` handles this):

```bash filename="Terminal"
CADDY_CERT_DIR="$(pwd)/.karrio/certs" caddy run --config docker/Caddyfile.dev
```

`./bin/dev up` accepts component names so you can launch only what you need. Add `--with-https` to enable the HTTPS proxy when desired:

```bash filename="Terminal"
./bin/dev up api                 # API + Maildev (localhost)
./bin/dev up dashboard           # Dashboard (localhost)
./bin/dev up docs                # Docs (localhost)
./bin/dev up api dashboard       # Mix and match (localhost)
./bin/dev up --with-https api    # Same, but with Caddy + HTTPS
```

HTTPS is off by default. To force-disable HTTPS in any context:

```bash filename="Terminal"
SKIP_CADDY=true ./bin/dev up
```

When you launch with `--with-https`, the script exports:

```bash
export KARRIO_URL=https://api.karrio.local
export KARRIO_PUBLIC_URL=https://api.karrio.local
export NEXT_PUBLIC_KARRIO_PUBLIC_URL=https://api.karrio.local
export NEXTAUTH_URL=https://app.karrio.local
```

If Caddy isn’t available the script keeps the `http://localhost:*` values. Update those variables (or the values in `apps/dashboard/.env`) if you need to point the UI at another API.

| Service   | HTTP                  | HTTPS (requires Caddy)   |
| --------- | --------------------- | ------------------------ |
| API       | http://localhost:5002 | https://api.karrio.local |
| Dashboard | http://localhost:3002 | https://app.karrio.local |
| Docs      | http://localhost:3005 | https://karrio.local     |
| Maildev   | http://localhost:1080 | –                        |

`./bin/dev up` also exports `NODE_EXTRA_CA_CERTS` to the mkcert root so the Next.js servers trust the HTTPS endpoints automatically.

### Stopping services

To stop all development services started by `./bin/dev up`:

```bash filename="Terminal"
./bin/dev down
```

If you started with `--no-wait`, you can stop later with the same `./bin/dev down` command.

## Classic Manual Setup (reference)

If you want the manual steps, the original workflow remains available.

### 1. Clone the Repository

```bash filename="Terminal"
git clone https://github.com/[YOUR_USERNAME]/karrio.git
cd karrio
```

### 2. Install System Dependencies

```bash filename="Terminal"
./bin/install-binaries
```

> This installs system dependencies based on your OS:
>
> - macOS: `gcc`, `pango`, `libffi`, `ghostscript`, `zint`, `caddy`, `mkcert`
> - Linux: `libpango1.0-0`, `libpangoft2-1.0-0`, `gcc`, `ghostscript`, `zint`, `caddy`, `mkcert`

If you encounter permission issues:

```bash filename="Terminal"
chmod +x ./bin/*
```

### 3. Set up Python Environment manually

```bash filename="Terminal"
source ./bin/setup-server-env
```

### 4. Apply Database Migrations

```bash filename="Terminal"
karrio migrate
```

<details>
  <summary>Using PostgreSQL Instead</summary>

Update your `.env` accordingly and start the PostgreSQL container with `docker compose -f docker/docker-compose.yml up -d db`.

</details>

### 5. Collect Static Assets

```bash filename="Terminal"
karrio collectstatic --noinput
```

### 6. Create Admin User

```bash filename="Terminal"
karrio createsuperuser
```

### 7. Start the Server

```bash filename="Terminal"
karrio runserver
```

### 8. Start the Dashboard manually

```bash filename="Terminal"
npm i
npm run dev -w @karrio/dashboard
```

## Working on the Server

```bash filename="Terminal"
source bin/activate-env
karrio migrate
karrio createsuperuser
karrio collectstatic --noinput
./bin/run-server-tests
```

## Database Management

```bash filename="Terminal"
# Reset
docker compose -f docker/docker-compose.yml down
docker compose -f docker/docker-compose.yml up -d db

# Backup
karrio dumpdata --natural-foreign --natural-primary -o ../backup/data.json

# Restore
karrio loaddata ../backup/data.json
```

## Code Organization

- **`apps/`**: API, dashboard, docs, marketing
- **`modules/`**: shared python packages (core, connectors, automation, …)
- **`bin/`**: helper scripts for development, testing, deployment
- **`docker/`**: docker-compose manifests and container assets
- **`schemas/`**: API schema definitions
- **`ee/`**: enterprise-specific code (when applicable)

## Adding a New Carrier

1. Create a new module under `modules/connectors`.
2. Implement the carrier interfaces (`CarrierInterface`, `ShippingInterface`, etc.).
3. Add configuration and validation.
4. Write tests and update documentation.

See [Adding a New Carrier](/docs/developing/carrier-integration) for the full walkthrough.

## Troubleshooting

- **Caddy fails to start** – ensure ports 80/443 are free and run `sudo setcap "cap_net_bind_service=+ep" $(command -v caddy)`. Check `/tmp/caddy-dev.log` for details.
- **Certificates not trusted** – rerun `./bin/install-dev` so mkcert reinstalls the local CA. Restart your browser afterwards.
- **Dashboard cannot reach API** – verify the API component is running or set `KARRIO_URL` to a remote endpoint before launching the dashboard.
- **Node or Python version warnings** – the setup script skips unsupported versions. Upgrade manually and rerun the script.

## Docker-based Development (Alternative)

Use the helper script to create and manage the dev container defined in the root `docker-compose.yml`:

```bash filename="Terminal"
# Create and initialize the dev container
./bin/docker-env create

# Open a shell in the dev container
./bin/docker-env shell
```

Start services inside the container (in separate terminals):

```bash filename="Terminal"
# API (terminal 1)
docker compose exec -it karriodev bash -lc 'source bin/activate-env; karrio runserver'

# Dashboard (terminal 2)
docker compose exec -it karriodev bash -lc 'npm run dev -w @karrio/dashboard'

# Docs (optional, terminal 3)
docker compose exec -it karriodev bash -lc 'npm run dev:web -w @karrio/web'
```

Optional HTTPS proxy (Caddy) from the host:

```bash filename="Terminal"
docker compose up -d caddy
```

Stop or remove the dev container:

```bash filename="Terminal"
./bin/docker-env off       # stop
./bin/docker-env destroy   # remove
```

Refer to [Self-hosting Environment Variables](/docs/self-hosting/environment) for tuning port mappings and credentials.
